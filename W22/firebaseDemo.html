<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Firebase Form Example</title>
  </head>
  <body>
    <h1>Submit User Info to Firebase</h1>

    <form id="userForm">
      <label for="username">Username:</label>
      <input type="text" id="username" name="username" required /><br /><br />
      <label for="email">Email:</label>
      <input type="email" id="email" name="email" required /><br /><br />
      <button type="submit">Submit</button>
    </form>

    <h2>Users in Database</h2>
    <ul id="userList"></ul>

    <script type="module">
      // Import Firebase SDK
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
      import {
        getDatabase,
        ref,
        set,
        push,
        onValue,
      } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

      // Your Firebase configuration (replace with your own config from the Firebase console please!)
      const firebaseConfig = {
        apiKey: "",
        authDomain: "fir-1e52a.firebaseapp.com",
        databaseURL:
          "https://fir-1e52a-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "fir-1e52a",
        storageBucket: "fir-1e52a.appspot.com",
        messagingSenderId: "971154362161",
        appId: "1:971154362161:web:10b0c2fb1f5db4ba0c6a10",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);

      // Function to write user data to Firebase
      function writeUserData(username, email) {
        // Push new data into the users collection
        const userRef = ref(database, "users");
        push(userRef, {
          username: username,
          email: email,
        })
          .then(() => {
            console.log("User added to database");
          })
          .catch((error) => {
            console.error("Error adding user:", error);
          });
      }

      // Form
      document
        .getElementById("userForm")
        .addEventListener("submit", function (e) {
          e.preventDefault(); // Prevent page reload on form submission

          // Get form values
          const username = document.getElementById("username").value;
          const email = document.getElementById("email").value;

          // Write data to Firebase
          writeUserData(username, email);

          document.getElementById("userForm").reset();
        });

      // Function to display users from Firebase in real-time
      const displayUsers = () => {
        const userList = document.getElementById("userList");
        const userRef = ref(database, "users");

        // Listen for changes in the database
        onValue(userRef, (snapshot) => {
          userList.innerHTML = ""; // Clear the list

          // Loop through users and display them
          snapshot.forEach((childSnapshot) => {
            const userData = childSnapshot.val();
            const li = document.createElement("li");
            li.textContent = `Username: ${userData.username}, Email: ${userData.email}`;
            userList.appendChild(li);
          });
        });
      };

      // Call the function to display users
      displayUsers();
    </script>
  </body>
</html>